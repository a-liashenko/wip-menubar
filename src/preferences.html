<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./assets/css/bulma.min.css">
  <link rel="stylesheet" href="./assets/css/style.css">
  <title>Preferences</title>
</head>

<body>

  <header>

      <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
          <div class="navbar-item">
            <img src="./icons/streaker-icon.svg" alt="Streaker Logo">
          </div>
          <div class="navbar-item">
            <span>Streaker</span>
          </div>
        </div>
      </nav>

  </header>

  <main>

    <nav class="panel">
      <p class="panel-heading">
        GitHub Username
      </p>
      <div class="field">
        <div class="control">
          <input id="githubUsername" type="text" class="input" placeholder="Type your GitHub username">
        </div>
      </div>
      <p class="panel-heading">
        GitHub Sync Interval
      </p>
      <div class="field">
        <div class="control">
          <input id="githubSyncInterval" type="number" class="input" placeholder="e.g 15">
          <span class="input-text">Minutes</span>
        </div>
      </div>
      <p class="panel-heading">
        Notifications
        <label class="checkbox is-pulled-right">
          <input id="notificationCheckbox" type="checkbox">
          Enable
        </label>
      </p>
      <div class="field">
        <div class="control">
          <input id="notificationHour" type="number" class="input" placeholder="hh" min="0" max="23" maxlength="2">
          <span class="input-text"> : </span>
          <input id="notificationMinutes" type="number" class="input" placeholder="mm" min="0" max="59" maxlength="2">
        </div>
      </div>
    </nav>

  </main>

  <script>

    const { ipcRenderer } = require('electron');

    const store = require('./store');

    const githubUsername = document.getElementById('githubUsername');
    const githubSyncInterval = document.getElementById('githubSyncInterval');
    const notificationCheckbox = document.getElementById('notificationCheckbox');
    const notificationHour = document.getElementById('notificationHour');
    const notificationMinutes = document.getElementById('notificationMinutes');

    githubUsername.value = store.get('username') || '';
    githubSyncInterval.value = store.get('syncInterval') || ''
    notificationHour.value = store.get('notification.hours') || '';
    notificationMinutes.value = store.get('notification.minutes') || '';

    if (githubUsername.value === '') {
      githubUsername.focus();
      githubUsername.classList.add('is-warning');
    }

    if (!store.get('notification.isEnabled')) {
      notificationHour.disabled = true;
      notificationMinutes.disabled = true;
    } else {
      notificationCheckbox.checked = true;
    }

    githubUsername.addEventListener('keyup', () => {
      githubUsername.parentElement.classList.add('is-loading');
      ipcRenderer.send('setUsername', githubUsername.value);
    })

    githubSyncInterval.addEventListener('keyup', () => {
      const syncInterval = githubSyncInterval.value;
      ipcRenderer.send('setSyncInterval', syncInterval);
    })

    notificationCheckbox.addEventListener('change', (event) => {
      if (notificationCheckbox.checked) {
        notificationHour.disabled = false;
        notificationMinutes.disabled = false;
        ipcRenderer.send('activateNotifications', notificationCheckbox.checked);
      } else {
        notificationHour.disabled = true;
        notificationMinutes.disabled = true;
        ipcRenderer.send('activateNotifications', notificationCheckbox.checked);
      }
    })

    ipcRenderer.on('usernameSet', () => {
      console.log('usernameSet : ', store.get('username'));
      githubUsername.parentElement.classList.remove('is-loading');
    });

    ipcRenderer.on('syncIntervalSet', () => {
      console.log('syncIntervalSet :', store.get('syncInterval'));
    })

    ipcRenderer.on('activateNotificationsSet', () => {
      console.log('Notification state : ', store.get('notification.isEnabled'));
    })

    ipcRenderer.on('NotificationTimeSet', () => {
      console.log('NotificationTimeSet : ', store.get('notification.time'));
    })

  </script>
</body>

</html>